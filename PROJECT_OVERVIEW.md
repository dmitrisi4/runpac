# Run Tracker PWA - Обзор проекта

## Описание проекта
Run Tracker PWA - это Progressive Web Application для отслеживания пробежек с функцией захвата территории. Когда пользователь завершает замкнутый маршрут, захваченная область визуализируется на карте.

## Технологический стек

### Frontend
- **React 19.1.1** - основной фреймворк
- **TypeScript** - типизация
- **Vite** - сборщик и dev-сервер
- **Leaflet.js + react-leaflet 5.0.0** - картографическая библиотека
- **Turf.js** - геопространственный анализ и расчеты
- **@turf/length** - расчет расстояний

### PWA возможности
- **vite-plugin-pwa** - превращение в PWA
- **Service Worker** - офлайн кэширование
- **Web App Manifest** - установка на устройство

## Структура проекта

```
src/
├── App.tsx          # Главный компонент приложения
├── App.css          # Стили приложения (пустой)
├── main.tsx         # Точка входа React
├── index.css        # Глобальные стили
└── components/
    └── Map.tsx       # Основной компонент карты (199 строк)
```

## Ключевые функции

### 1. Отслеживание пробежки
- **GPS трекинг** через `navigator.geolocation.watchPosition()`
- **Режим реального времени** с высокой точностью
- **Визуализация маршрута** синей линией (Polyline)
- **Расчет расстояния** в километрах через Turf.js

### 2. Захват территории
- **Автоматическое определение** замкнутых маршрутов
- **Алгоритм**: если начальная и конечная точки находятся в пределах 150 метров
- **Визуализация** захваченных областей фиолетовыми полигонами
- **Использование Turf.js** для геометрических расчетов

### 3. Симуляция пробежки
- **Предопределенный маршрут** `MOCK_RUN_PATH` в Лондоне
- **Автоматическое воспроизведение** с интервалом 500мс
- **Тестирование функционала** без реального GPS

## Основные компоненты

### Map.tsx - Главный компонент
**Состояние (State):**
- `tracking: boolean` - активность трекинга
- `isSimulating: boolean` - режим симуляции
- `path: LatLngTuple[]` - текущий маршрут
- `currentPosition: LatLngTuple | null` - текущая позиция
- `capturedAreas: LatLngTuple[][]` - захваченные области
- `distance: number` - общее расстояние в км

**Ключевые функции:**
- `handleStartTracking()` - запуск GPS трекинга
- `handleStopTracking()` - остановка и проверка захвата
- `handleSimulateRun()` - симуляция пробежки
- `checkForTerritoryCapture()` - анализ замкнутости маршрута
- `ChangeView` - автоматическое центрирование карты

### Типы данных
```typescript
type LatLngTuple = [number, number]; // [latitude, longitude]
```

## Конфигурация

### Vite конфигурация (vite.config.ts)
- **React plugin** с Fast Refresh
- **PWA plugin** с автообновлением
- **Workbox** для кэширования статических файлов
- **Manifest** для установки PWA

### PWA Manifest
- **Название**: "Run Tracker & Territory Capture"
- **Короткое имя**: "RunTracker"
- **Режим отображения**: standalone
- **Иконки**: SVG с различными размерами

### TypeScript конфигурация
- **Target**: ES2020
- **Module**: ESNext
- **Strict mode**: включен
- **JSX**: react-jsx

## Команды разработки

```bash
# Установка зависимостей
npm install

# Запуск dev-сервера
npm run dev          # http://localhost:5173

# Сборка для продакшена
npm run build        # создает папку dist/

# Предварительный просмотр сборки
npm preview

# Линтинг кода
npm run lint
```

## Особенности реализации

### Геолокация
- **Высокая точность**: `enableHighAccuracy: true`
- **Таймаут**: 10 секунд
- **Обработка ошибок** с пользовательскими уведомлениями
- **Очистка watcher'а** при остановке

### Карта (Leaflet)
- **Базовая карта**: OpenStreetMap
- **Начальная позиция**: Лондон [51.505, -0.09]
- **Автоматическое центрирование** на текущей позиции
- **Zoom**: 13 (общий вид), 14 (при трекинге)

### UI/UX
- **Плавающая панель** с кнопками управления
- **Отображение расстояния** в реальном времени
- **Адаптивные кнопки** в зависимости от состояния
- **Полноэкранная карта** (100vh)

## Тестирование

### Автоматизированное тестирование
- **Playwright** для E2E тестов
- **Файл**: `jules-scratch/verification/verify_distance_display.py`
- **Проверка**: симуляция пробежки и отображение расстояния

## Потенциальные улучшения

1. **Персистентность данных** - localStorage/IndexedDB
2. **Статистика пробежек** - время, скорость, калории
3. **Бэкенд интеграция** - синхронизация между устройствами
4. **UI библиотека** - Material-UI или Tailwind CSS
5. **Офлайн режим** - расширенные PWA возможности
6. **Экспорт данных** - GPX, KML форматы

## Системные требования

- **Node.js**: версия 20.x или новее
- **Браузер**: поддержка Geolocation API
- **HTTPS**: для продакшена (требование Geolocation API)
- **Разрешения**: доступ к геолокации пользователя

## Архитектурные решения

- **Client-side focused** - вся логика на фронтенде
- **Компонентная архитектура** React
- **Функциональные компоненты** с хуками
- **TypeScript** для типобезопасности
- **Модульная структура** с четким разделением ответственности

Этот файл содержит всю ключевую информацию для быстрого понимания проекта и продолжения разработки.